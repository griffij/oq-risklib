#!/usr/bin/env python
from openquake.commonlib import sap
from openquake.commonlib.node import node_from_xml


def print_slowest(xunit_fname, numtests=20):
    """
    Print the names and times of the slowest tests
    """
    data = []
    for node in node_from_xml(xunit_fname):
        testname = '%(classname)s.%(name)s' % node.attrib
        testtime = float(node['time'])
        data.append((testtime, testname))
    data.sort(reverse=True)
    for row in data[:numtests]:
        print row[1], row[0]


parser = sap.Parser(print_slowest)
parser.arg('xunit_fname', 'the file nosetests.xml')
parser.arg('numtests', 'maximum number of times to print', type=int)

if __name__ == '__main__':
    parser.callfunc()
